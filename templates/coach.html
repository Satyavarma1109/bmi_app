<!DOCTYPE html>
<html>
<head>
    <title>AI Coach</title>
    <style>
        body { font-family: Arial; max-width: 900px; margin: 30px auto; padding: 12px; color:#111; }
        h2 { margin: 0 0 8px 0; }
        .sub { margin: 0 0 18px 0; color:#555; }

        .topnav { 
            display:flex; 
            gap:12px; 
            margin: 22px 0 0; 
            flex-wrap: wrap; 
        }
        .btn {
            display:inline-block; padding:10px 14px; border:1px solid #ccc; border-radius:10px;
            text-decoration:none; color:#111; background:#fff;
        }
        .btn.red { border-color:#ffb3b3; color:#b10000; }
        .btn.primary { border-color:#b9d7ff; background:#eef6ff; }

        .card { border:1px solid #e6e6e6; border-radius:14px; padding:16px; background:#fff; }

        label { display:block; font-weight:700; margin: 10px 0 6px; }
        select, input, button, textarea {
            width:100%; padding:10px; border-radius:10px; border:1px solid #cfcfcf; font-size:1rem;
        }
        button { cursor:pointer; }
        .muted { color:#666; font-size:0.92rem; }
        .error { margin-top:12px; padding:12px; border-radius:12px; border:1px solid #ffc1c1; background:#fff5f5; color:#b10000; }

        .week-tabs { display:flex; gap:10px; flex-wrap:wrap; margin:16px 0 14px; }
        .tab {
            padding:10px 14px; border:1px solid #ddd; border-radius:999px; text-decoration:none; color:#111;
            background:#fafafa;
        }
        .tab.active { border-color:#3b82f6; background:#eef6ff; font-weight:700; }

        .week-box {
            border-left:6px solid #3b82f6;
            background:#f7fbff;
            padding:14px;
            border-radius:14px;
            margin-bottom: 14px;
        }
        .week-title { font-size:1.15rem; font-weight:800; margin:0 0 8px 0; color:#0b2a55; }
        .week-content { white-space: pre-wrap; line-height:1.45; margin:0; }

        .chat-wrap { margin-top: 24px; }
        .chat-title { font-weight:800; margin: 0 0 8px 0; }
        .chat-box {
            border:1px solid #e6e6e6; border-radius:14px; padding:12px; background:#fcfcfc;
            max-height: 280px; overflow:auto;
        }
        .msg { padding:10px 12px; border-radius:12px; margin:8px 0; max-width: 92%; }
        .msg.user { background:#eef6ff; border:1px solid #cfe3ff; margin-left:auto; }
        .msg.ai { background:#f4fff6; border:1px solid #cfead3; margin-right:auto; }

        .ask-row { margin-top:12px; display:flex; gap:10px; }
        .ask-row textarea { flex:1; min-height: 44px; resize: vertical; }
        .ask-row button { width: 180px; border-color:#b9d7ff; background:#eef6ff; font-weight:700; }
        @media (max-width: 640px) {
            .ask-row { flex-direction: column; }
            .ask-row button { width:100%; }
        }

        /* AI FITNESS IMAGE */
        .ai-banner {
            width: 100%;
            max-width: 850px;
            display: block;
            margin: 16px auto 18px auto;
            border-radius: 14px;
        }
    </style>
</head>

<body>
    <h2>AI Fitness Coach</h2>

    <!-- Banner -->
    <img src="{{ url_for('static', filename='images/ai_fitness.png') }}"
         alt="AI Fitness"
         class="ai-banner">

    <!-- ⭐ CHAT MOVED TO TOP -->
    <div class="card">
        <div class="chat-wrap">
            <p class="chat-title">Ask the Coach (Live Chat)</p>

            <div class="chat-box">
                {% if chat and chat|length > 0 %}
                    {% for m in chat %}
                        {% if m.role == "user" %}
                            <div class="msg user"><strong>You:</strong> {{ m.content }}</div>
                        {% else %}
                            <div class="msg ai"><strong>Coach:</strong> {{ m.content }}</div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <div class="muted">
                        No questions yet. Ask anything like: “Give me Week 1 workout for beginners”
                    </div>
                {% endif %}
            </div>

            <form method="POST" class="ask-row">
                <input type="hidden" name="action" value="ask">
                <input type="hidden" name="goal" value="{{ goal }}">
                <textarea name="question" placeholder="Your question..."></textarea>
                <button type="submit">Ask Coach</button>
            </form>
        </div>
    </div>

    <br>

    <!-- Goal + Plan Section -->
    <div class="card">

        <form method="POST">
            <input type="hidden" name="action" value="generate">
            <label>Goal</label>
            <select name="goal">
                <option value="lose weight" {% if goal == "lose weight" %}selected{% endif %}>Lose Weight</option>
                <option value="maintain weight" {% if goal == "maintain weight" %}selected{% endif %}>Maintain Weight</option>
                <option value="gain weight" {% if goal == "gain weight" %}selected{% endif %}>Gain Weight</option>
            </select>

            <div style="margin-top:10px;">
                <button type="submit">Generate Plan</button>
                <div class="muted" style="margin-top:8px;">
                    Tip: If you update your BMI in the BMI Calculator, generate again to refresh the plan.
                </div>
            </div>
        </form>

        {% if plan_text %}
            <div class="week-tabs">
                <a class="tab {% if week==1 %}active{% endif %}" href="{{ url_for('coach', week=1) }}">Week 1</a>
                <a class="tab {% if week==2 %}active{% endif %}" href="{{ url_for('coach', week=2) }}">Week 2</a>
                <a class="tab {% if week==3 %}active{% endif %}" href="{{ url_for('coach', week=3) }}">Week 3</a>
                <a class="tab {% if week==4 %}active{% endif %}" href="{{ url_for('coach', week=4) }}">Week 4</a>
            </div>

            <div class="week-box">
                <p class="week-title">Week {{ week }}</p>
                <pre class="week-content">{{ week_text }}</pre>
            </div>
        {% endif %}
    </div>

    <!-- ⭐ NAV BUTTONS AT BOTTOM -->
    <div class="topnav">
        <a class="btn" href="{{ url_for('bmi_page') }}">← Back to BMI</a>
        <a class="btn" href="{{ url_for('dashboard') }}">Dashboard</a>
        <a class="btn red" href="{{ url_for('logout') }}">Logout</a>
    </div>

</body>
</html>
